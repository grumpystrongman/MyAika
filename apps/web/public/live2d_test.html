<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Live2D Self Test</title>
  <style>
    html, body { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #111; }
    #wrap { display: flex; height: 100%; }
    #left { flex: 1; position: relative; }
    #right { width: 320px; background: #0f172a; color: #e2e8f0; font: 12px/1.4 system-ui; padding: 12px; overflow: auto; }
    canvas { width: 100%; height: 100%; display: block; }
    .ok { color: #22c55e; }
    .bad { color: #ef4444; }
  </style>
</head>
<body>
  <div id="wrap">
    <div id="left"><canvas id="c"></canvas></div>
    <div id="right">
      <div><b>Live2D Self Test</b></div>
      <div id="log"></div>
    </div>
  </div>
  <script>
    const logEl = document.getElementById('log');
    const log = (msg, ok=true) => {
      const div = document.createElement('div');
      div.className = ok ? 'ok' : 'bad';
      div.textContent = msg;
      logEl.appendChild(div);
    };

    function loadScript(src) {
      return new Promise((resolve, reject) => {
        const s = document.createElement('script');
        s.src = src; s.async = true;
        s.onload = resolve;
        s.onerror = () => reject(new Error('load failed: ' + src));
        document.head.appendChild(s);
      });
    }

    (async () => {
      try {
        await loadScript('/vendor/pixi.min.js');
        log('PIXI loaded: ' + (!!window.PIXI));
        await loadScript('/assets/aika/live2d/live2dcubismcore.js');
        log('Cubism core loaded: ' + (!!window.Live2DCubismCore));
        await loadScript('/vendor/cubism4.min.js');
        log('pixi-live2d loaded: ' + (!!(window.PIXI && window.PIXI.live2d && window.PIXI.live2d.Live2DModel)));

        const { Live2DModel } = window.PIXI.live2d;
        const app = new window.PIXI.Application({ view: document.getElementById('c'), autoStart: true, backgroundAlpha: 0 });
        const modelUrl = '/assets/aika/live2d/miku/miku.model3.json';
        const model = await Live2DModel.from(modelUrl);
        app.stage.addChild(model);
        const bounds = model.getBounds();
        const scale = Math.min(app.renderer.width / bounds.width, app.renderer.height / bounds.height) * 0.95;
        model.scale.set(scale);
        model.anchor?.set?.(0.5, 1);
        model.x = app.renderer.width * 0.5;
        model.y = app.renderer.height * 0.98;
        log('Model loaded OK');
      } catch (e) {
        log('ERROR: ' + (e?.message || e), false);
      }
    })();
  </script>
</body>
</html>
